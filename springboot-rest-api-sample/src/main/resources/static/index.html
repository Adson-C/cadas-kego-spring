<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>Cadastro de Clientes</title>



<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">

</head>

<body>


	<div class="card border-primary mb-3" style="max-width: 50rem;">
		<div class="card-header">Cadastro de Usuário</div>
		<div class="card-body text-secondary">


			<form class="form-material" enctype="multipart/form-data" action="" id="formCadatroUser">

				<input type="hidden" name="acao" id="acao" value="">

				<div class="form-group form-default form-static-label">
					<label class="float-label">ID:</label> <input type="text" name="id"
						id="id" class="form-control" readonly="readonly"> <span
						class="form-bar"></span>
				</div>


				<div class="form-group form-default form-static-label">
					<label class="float-label">Nome:</label> <input type="text"
						name="nome" id="nome" class="form-control" required="required" >
					<span class="form-bar"></span>
				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Idade:</label> <input type="text"
						name="idade" id="idade" class="form-control" required="required">
					<span class="form-bar"></span>
				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">CPF:</label> <input type="text"
						name="cpf" id="cpf" class="form-control" required="required">
					<span class="form-bar"></span>
				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">E-mail:</label> <input type="email"
						name="email" id="email" class="form-control" required="required"
						autocomplete="off"> <span class="form-bar"></span>
				</div>



				<div class="form-group form-default form-static-label">
					<label class="float-label">Cep:</label> <input
						onblur="pesquisaCep();" type="text" name="cep" id="cep"
						class="form-control" required="required" autocomplete="off">
					<span class="form-bar"></span>

				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Logradouro:</label> <input type="text"
						name=logradouro id=logradouro class="form-control" required="required" autocomplete="off"> 
						 <span class="form-bar"></span>

				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Bairro:</label> <input type="text"
						name="bairro" id="bairro" class="form-control" required="required"
						autocomplete="off"> <span class="form-bar"></span>

				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Cidade:</label> <input type="text"
						name="cidade" id="cidade" class="form-control" required="required"
						autocomplete="off"> <span class="form-bar"></span>

				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Uf:</label> <input type="text" name="uf"
						id="uf" class="form-control" required="required"
						autocomplete="off"> <span class="form-bar"></span>

				</div>

				<div class="form-group form-default form-static-label">
					<label class="float-label">Numero:</label> <input type="text"
						name="numero" id="numero" class="form-control" required="required"
						autocomplete="off"> <span class="form-bar"></span>

				</div>

			</form>
			<button type="button" onclick="salvarUsuario()" class="btn btn-primary">Salvar</button>
			<button type="button" class="btn btn-secondary" onclick="document.getElementById('formCadatroUser').reset();">Novo</button>
			<button type="button" class="btn btn-danger"  data-bs-toggle="modal"  data-bs-target="#modalPesquisarUser">Pesquisar</button>
		
		
			
<div class="modal fade" id="modalPesquisarUser" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Pesquisa de usuário</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="nameBusca" class="col-form-label">Informe o nome:</label>
            <input type="text" class="form-control" id="nameBusca">
          </div>
          <button type="button" class="btn btn-success" onclick="pesquisarUser()">Buscar</button>
        </form>

				<div style="height: 300px;overflow: scroll;">
					<table class="table" id="tabelaresultados">
						<thead>
							<tr>
								<th scope="col">ID</th>
								<th scope="col">Nome</th>
								<th scope="col">Editar</th>
								<th scope="col">Delete</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
				</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

		</div>


	</div>
	
			<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

			<script
				src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
				integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
				crossorigin="anonymous"></script>
				
<script type="text/javascript">

function salvarUsuario() {
	
	var id = $("#id").val();
	var nome = $("#nome").val();
	var idade = $("#idade").val();
	var cpf = $("#cpf").val();
	var email = $("#email").val();
	var cep = $("#cep").val();
	var logradouro = $("#logradouro").val();
    var bairro = $("#bairro").val();
    var cidade = $("#cidade").val();
    var uf = $("#uf").val();
     var numero = $("#numero").val();
	
     $.ajax({
			method : "POST",
			url : "save",
			data : JSON.stringify({
				id : id,
				nome : nome,
				idade : idade,
				cpf : cpf,
				email : email,
				cep : cep,
				nome : nome,
				logradouro : logradouro,
				bairro : bairro,
				cidade : cidade,
				uf : uf,
				numero : numero
				
			}),
			contentType : "application/json; charset=utf-8",
			success : function(response) {
				
				$("#id").val(response.id);
				alert("Salvo com sucesso!");
			}
		}).fail(function(xhr, status, errorThrown) {
			alert("Erro ao Salvar : " + xhr.responseText);
		});
	
	
	}
	
function pesquisaCep() {
	var cep = $("#cep").val();
	
	$.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {
		
		if (!("erro" in dados)) {
            //Atualiza os campos com os valores da consulta.
            $("#cep").val(dados.cep);
            $("#logradouro").val(dados.logradouro);
            $("#bairro").val(dados.bairro);
            $("#cidade").val(dados.localidade);
            $("#uf").val(dados.uf);
        } //fim do if.
		
	});
}
	
function pesquisarUser(){
	  var nome = $('#nameBusca').val();
	  
	  if (nome != null && nome.trim() != ''){
		  
		  
		  $.ajax({
				method : "GET",
				url : "bucaporname",
				data : "name=" + nome ,
				success : function(response) {
					$('#tabelaresultados > tbody > tr').remove();
					
					for (var i = 0; i < response.length; i++){
						$('#tabelaresultados > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].id+'</td><td>'+response[i].nome+'</td><td><button type="button" onclick="colocarEmEdicao('+response[i].id+')" class="btn btn-primary">Ver</button><td></tr>');
					}
				  
				}
			}).fail(function(xhr, status, errorThrown) {
				alert("Erro ao buscar usuario: " + xhr.responseText);
			});
		  
	  }
}


function colocarEmEdicao(id) {
	  
	  
	  $.ajax({
			method : "GET",
			url : "bucaruserid",
			data : "iduser=" + id ,
			success : function(response) {

				$("#id").val(response.id);
				$("#nome").val(response.nome);
				$("#idade").val(response.idade);
				$("#cpf").val(response.cpf);
				$("#email").val(response.email);
				$("#cep").val(response.cep);
				$("#logradouro").val(response.logradouro);
			    $("#bairro").val(response.bairro);
			    $("#cidade").val(response.cidade);
			    $("#uf").val(response.uf);
			     $("#numero").val(response.numero);
				
				
				$('#modalPesquisarUser').modal('hide');			  
			}
		}).fail(function(xhr, status, errorThrown) {
			alert("Erro ao buscar usuario por id: " + xhr.responseText);
		});
	  
	  
}


</script>


</body>

</html>
